<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Built-Up Change Explorer</title>
  <style>
    :root {
      --bg: #111;
      --border: #ddd;
      --text: #222;
      --muted: #444;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 14px;
      margin: 0;
      background: #fff;
      color: var(--text);
    }
    h3 { margin: 0 0 12px 0; font-weight: 700; }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      max-width: 1600px;
      margin-bottom: 12px;
    }
    .control label { display: block; font-size: 14px; margin-bottom: 6px; }
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: #fff;
      font-size: 16px;
    }

    #swipe-container {
      position: relative;
      width: 100%;
      max-width: 1600px;
      aspect-ratio: 3508 / 4961;
      height: auto;
      max-height: 2000px;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      background: var(--bg);
      touch-action: none;
    }

    .plot-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .layer-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      user-select: none;
      -webkit-user-drag: none;
    }

    /* BEFORE is the base image */
    #before-img { z-index: 1; }

    /* AFTER is on top, clipped */
    #after-clip {
      position: absolute;
      inset: 0;
      z-index: 2;
      overflow: hidden;              /* IMPORTANT */
      clip-path: inset(0 0 0 50%);   /* show RIGHT half initially */
      will-change: clip-path;
    }
    
    #after-img { z-index: 1; object-position: center; }
    #before-img { z-index: 1; object-position: center; }

    #swipe-handle {
      position: absolute;
      top: 0;
      left: 50%;
      height: 100%;
      width: 34px;
      transform: translateX(-50%);
      cursor: ew-resize;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      touch-action: none;
      pointer-events: auto;
    }
    #swipe-handle .line {
      position: absolute;
      top: 0; bottom: 0;
      width: 2px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 0 6px rgba(0,0,0,0.35);
    }
    #swipe-handle .knob {
      width: 26px;
      height: 44px;
      border-radius: 999px;
      background: rgba(255,255,255,0.88);
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #111;
    }

    #meta {
      max-width: 1100px;
      color: var(--muted);
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <h3>Blue River Watershed – Built-up Index (NDBI) 1985-2025</h3>

  <div class="controls">
    <div class="control">
      <label for="before-year">Before year</label>
      <select id="before-year"></select>
    </div>
    <div class="control">
      <label for="after-year">After year</label>
      <select id="after-year"></select>
    </div>
  </div>

  <div id="swipe-container" aria-label="Swipe compare">
    <div class="plot-layer">
      <img id="before-img" class="layer-img" alt="Before layer" />
      <div id="after-clip">
        <img id="after-img" class="layer-img" alt="After layer" />
      </div>
    </div>

    <div id="swipe-handle" title="Built-Up Change Explorer" role="slider"
         aria-valuemin="0" aria-valuemax="100" aria-valuenow="50">
      <div class="line"></div>
      <div class="knob">⇆</div>
    </div>
  </div>

  <div id="meta"></div>

  <script>
    const years = [
      1984, 1985, 1986, 1987, 1988, 1989,
      1990, 1991, 1992, 1993, 1994, 1995,
      1996, 1997, 1998, 1999,
      2000, 2001, 2002, 2003, 2004, 2005,
      2006, 2007, 2008, 2009,
      2010, 2011, 2012, 2013, 2014, 2015,
      2016, 2017, 2018, 2019,
      2020, 2021, 2022, 2023, 2024, 2025
    ];

    const DEFAULT_BEFORE = years[1];
    const DEFAULT_AFTER  = years[years.length - 1];

    const beforeSel = document.getElementById("before-year");
    const afterSel  = document.getElementById("after-year");
    const beforeImg = document.getElementById("before-img");
    const afterImg  = document.getElementById("after-img");
    const afterClip = document.getElementById("after-clip");
    const handle    = document.getElementById("swipe-handle");
    const container = document.getElementById("swipe-container");
    const meta      = document.getElementById("meta");

    function setOptions(selectEl, defaultVal) {
      selectEl.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join("");
      selectEl.value = String(defaultVal);
    }

    function assetPath(year) {
      return `assets/${year}.png`;
    }

    function updateImages() {
      const beforeYear = beforeSel.value;
      const afterYear  = afterSel.value;
      beforeImg.src = assetPath(beforeYear);
      afterImg.src  = assetPath(afterYear);
      meta.textContent = `Before: ${beforeYear} | After: ${afterYear}`;
    }

    // Clip LEFT side of AFTER, keep RIGHT side visible
    function setPct(pct) {
      pct = Math.max(0, Math.min(100, pct));

      // Keep RIGHT side of AFTER. Hide everything LEFT of the handle.
      afterClip.style.clipPath = `inset(0 0 0 ${pct}%)`;

      // Handle follows the pointer normally
      handle.style.left = `${pct}%`;
      handle.setAttribute("aria-valuenow", String(Math.round(pct)));
    }


    setOptions(beforeSel, DEFAULT_BEFORE);
    setOptions(afterSel, DEFAULT_AFTER);

    beforeSel.addEventListener("change", updateImages);
    afterSel.addEventListener("change", updateImages);

    updateImages();
    setPct(50);

    let dragging = false;

    function pctFromEvent(e) {
      const rect = container.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const x = clientX - rect.left;
      return (x / rect.width) * 100;
    }

    handle.addEventListener("pointerdown", (e) => {
      dragging = true;
      handle.setPointerCapture?.(e.pointerId);
      setPct(pctFromEvent(e));
      e.preventDefault();
    });

    window.addEventListener("pointerup", () => { dragging = false; });

    window.addEventListener("pointermove", (e) => {
      if (!dragging) return;
      setPct(pctFromEvent(e));
      e.preventDefault();
    });

    container.addEventListener("pointerdown", (e) => {
      if (e.target === handle || handle.contains(e.target)) return;
      setPct(pctFromEvent(e));
    });

    handle.tabIndex = 0;
    handle.addEventListener("keydown", (e) => {
      const step = e.shiftKey ? 10 : 2;
      const now = Number(handle.getAttribute("aria-valuenow") || "50");
      if (e.key === "ArrowLeft") setPct(now - step);
      if (e.key === "ArrowRight") setPct(now + step);
    });
  </script>
</body>
</html>
